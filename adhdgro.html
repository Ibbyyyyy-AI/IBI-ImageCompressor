
<html lang="en"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>ADHD Self-Check - IBI TOOLS</title> <meta name="description" content="A private, fast, offline ADHD self-screening tool based on ASRS v1.1. Get instant results with charts and history tracking."> <script type="application/ld+json"> { "@context": "https://schema.org", "@type": "MedicalWebPage", "name": "ADHD Self-Check", "url": "https://example.com/adhd-checker.html", "about": { "@type": "MedicalCondition", "name": "Attention Deficit Hyperactivity Disorder (ADHD)" }, "description": "An online self-assessment tool for ADHD symptoms using the ASRS v1.1 questionnaire." } </script> <style> :root { --bg: #071025; --card: #0b1220; --muted: #94a3b8; --accent: #7c3aed; --glass: rgba(255,255,255,0.03); --text: #e6eef8; } [data-theme="light"] { --bg: #f8fafc; --card: #ffffff; --muted: #475569; --accent: #0ea5a4; --glass: rgba(2,6,23,0.03); --text: #0f172a; } [data-theme="amoled"] { --bg: #000000; --card: #111111; --muted: #888888; --accent: #7c3aed; --glass: rgba(255,255,255,0.01); --text: #ffffff; } [data-theme="high-contrast"] { --bg: #000000; --card: #ffffff; --muted: #000000; --accent: #ff0000; --glass: rgba(255,255,255,0); --text: #ffffff; border: 1px solid #ffffff; } body { background: var(--bg); color: var(--text); font-family: system-ui, sans-serif; margin: 0; padding: 0; display: grid; grid-template-columns: 1fr minmax(300px, 800px) 300px 1fr; min-height: 100vh; } main { grid-column: 2 / 3; padding: 1rem; } aside.sidebar { grid-column: 3 / 4; padding: 1rem; } .header { display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--card); border-radius: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); } .logo { width: 50px; height: 50px; background: linear-gradient(to bottom right, var(--accent), #ffffff); border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--bg); } .subtitle { text-align: center; margin: 1rem 0; } .card { background: var(--card); border-radius: 1rem; padding: 1rem; margin: 1rem 0; box-shadow: 0 4px 6px rgba(0,0,0,0.1); backdrop-filter: blur(10px); background: var(--glass); } .progress { background: var(--muted); height: 10px; border-radius: 5px; margin: 1rem 0; } .progress-bar { background: var(--accent); height: 100%; border-radius: 5px; transition: width 0.3s; } .answers { display: flex; flex-wrap: wrap; gap: 0.5rem; } .answer-btn { background: var(--glass); border: 1px solid var(--muted); border-radius: 0.5rem; padding: 0.5rem 1rem; cursor: pointer; transition: background 0.3s; display: block; } .answer-btn.selected { background: var(--accent); color: var(--bg); } .nav-btn { background: var(--accent); color: var(--bg); border: none; border-radius: 0.5rem; padding: 0.5rem 1rem; cursor: pointer; margin: 0.5rem; } #results, #history, #certificate { display: none; } canvas { max-width: 100%; } #ad-top, #ad-bottom { margin: 1rem 0; min-height: 90px; } .faq { margin: 2rem 0; } .faq details { margin: 1rem 0; } @media print { #ad-top, #ad-bottom, .nav-btn:not(#print-btn, #print-cert), #theme-select, #privacy-toggle, #sidebar, #view-history { display: none; } body { background: white; color: black; grid-template-columns: 1fr minmax(300px, 800px) 1fr; } aside { display: none; } } @media (prefers-color-scheme: light) { :root:not([data-theme]) { --bg: #f8fafc; --card: #ffffff; --muted: #475569; --accent: #0ea5a4; --glass: rgba(2,6,23,0.03); --text: #0f172a; } } @media (max-width: 1100px) { body { grid-template-columns: 1fr minmax(300px, 800px) 1fr; } aside.sidebar { display: none; } .header select, .header label { display: inline-block; } } </style> </head> <body data-theme="dark"> <main> <div id="ad-top"></div> <header class="header card"> <div class="logo">IBI</div> <div>Made by IBI</div> </header> <h2 class="subtitle">ADHD Self-Check — Private, Fast, Offline</h2> <div class="card" id="description"> <p>This tool is based on the Adult ADHD Self-Report Scale (ASRS v1.1). It is not a diagnostic tool. Consult a healthcare professional for proper diagnosis.</p> </div> <div class="card" id="test-container"> <div class="progress"><div class="progress-bar" id="progress-bar" style="width:0%;"></div></div> <p id="progress-text" aria-live="polite">Question 1 of 18</p> <h3 id="question-text"></h3> <button id="read-question">Read Question</button> <button id="voice-answer">Voice Answer</button> <div class="answers" id="answers" role="radiogroup" aria-label="Answer choices"></div> <button class="nav-btn" id="prev-btn">Back</button> <button class="nav-btn" id="next-btn">Next</button> </div> <div class="card" id="results"> <h2>Your Results</h2> <p id="score-text"></p> <p id="likelihood-text"></p> <p id="explanation"></p> <p><strong>Disclaimer:</strong> This is not medical advice. See a doctor for diagnosis.</p> <canvas id="bar-chart" width="400" height="200"></canvas> <canvas id="radar-chart" width="400" height="400"></canvas> <button id="copy-summary">Copy Summary</button> <button id="share-result">Share Result</button> <button id="print-result">Print Result</button> <button id="view-history">View History</button> <button id="restart-test">Restart Test</button> </div> <div class="card" id="history"> <h2>History</h2> <ul id="history-list"></ul> <canvas id="comparison-chart" width="400" height="200" style="display:none;"></canvas> <button id="clear-history">Clear All</button> <button id="back-to-results">Back to Results</button> </div> <div class="card" id="certificate"> <h2>ADHD Self-Check Certificate</h2> <p id="cert-date"></p> <p id="cert-score"></p> <p id="cert-likelihood"></p> <button id="print-cert">Print</button> <button id="back-to-results-cert">Back</button> </div> <section class="faq card"> <h2>FAQ</h2> <details> <summary>What is ADHD?</summary> <p>ADHD is a neurodevelopmental disorder characterized by inattention, hyperactivity, and impulsivity.</p> </details> <details> <summary>Is this test accurate?</summary> <p>This is a screening tool, not a diagnosis. Accuracy depends on honest answers.</p> </details> <details> <summary>How is the score calculated?</summary> <p>Based on ASRS v1.1: sum of responses, with Part A positives for likelihood.</p> </details> <details> <summary>Should I see a doctor?</summary> <p>Yes, if results indicate high likelihood or if symptoms affect your life.</p> </details> <details> <summary>Is my data private?</summary> <p>Yes, everything is offline and local. Privacy mode disables storage.</p> </details> </section> <div id="ad-bottom"></div> <footer class="card">Made by IBI — IBI TOOLS</footer> </main> <aside class="sidebar card" id="sidebar"> <h3>Settings</h3> <select id="theme-select"> <option value="auto">Auto</option> <option value="dark">Dark</option> <option value="light">Light</option> <option value="amoled">AMOLED</option> <option value="high-contrast">High Contrast</option> </select> <label>Privacy Mode: <input type="checkbox" id="privacy-toggle"></label> </aside> <script> const ADSENSE = { enabled: false, client: "ca-pub-XXXX", topSlot: "YYYY", bottomSlot: "ZZZZ" };
const questions = [
"How often do you have trouble wrapping up the final details of a project, once the challenging parts have been done?",
"How often do you have difficulty getting things in order when you have to do a task that requires organization?",
"How often do you have problems remembering appointments or obligations?",
"When you have a task that requires a lot of thought, how often do you avoid or delay getting started?",
"How often do you fidget or squirm with your hands or feet when you have to sit down for a long time?",
"How often do you feel overly active and compelled to do things, like you were driven by a motor?",
"How often do you make careless mistakes when you have to work on a boring or difficult project?",
"How often do you have difficulty keeping your attention when you are doing boring or repetitive work?",
"How often do you have difficulty concentrating on what people say to you, even when they are speaking to you directly?",
"How often do you misplace or have difficulty finding things at home or at work?",
"How often are you distracted by activity or noise around you?",
"How often do you leave your seat in meetings or other situations in which you are expected to remain seated?",
"How often do you feel restless or fidgety?",
"How often do you have difficulty unwinding and relaxing when you have time to yourself?",
"How often do you find yourself talking too much when you are in social situations?",
"When you’re in a conversation, how often do you find yourself finishing the sentences of the people you are talking to, before they can finish them themselves?",
"How often do you have difficulty waiting your turn in situations when turn taking is required?",
"How often do you interrupt others when they are busy?"
];
const answersOptions = ["Never", "Rarely", "Sometimes", "Often", "Very often"];
const answerValues = [0, 1, 2, 3, 4];

let answers = new Array(18).fill(null);
let currentQuestion = 0;
let privacyMode = false;
let history = [];
let currentResult = null;
let devMode = new URLSearchParams(window.location.search).get('dev') === '1';
let utterance = null;

function init() {
loadTheme();
loadPrivacy();
loadHistory();
showQuestion(0);
initAds();
if (devMode) {
document.body.insertAdjacentHTML('beforeend', '

<button onclick="clearStorage()">Clear Storage</button><button onclick="toggleAds()">Toggle Ads</button>
'); updateDevJson(); } document.getElementById('theme-select').addEventListener('change', e => { const theme = e.target.value; if (theme === 'auto') { document.body.removeAttribute('data-theme'); localStorage.removeItem('theme'); } else { document.body.setAttribute('data-theme', theme); localStorage.setItem('theme', theme); } }); document.getElementById('privacy-toggle').addEventListener('change', e => { privacyMode = e.target.checked; try { localStorage.setItem('privacy', privacyMode); } catch (e) { console.error(e); } if (privacyMode) { hideAds(); document.getElementById('view-history').style.display = 'none'; } else { showAds(); document.getElementById('view-history').style.display = ''; } }); document.getElementById('prev-btn').addEventListener('click', () => { if (currentQuestion > 0) showQuestion(--currentQuestion); }); document.getElementById('next-btn').addEventListener('click', () => { if (answers[currentQuestion] !== null && currentQuestion < 17) showQuestion(++currentQuestion); else if (currentQuestion === 17 && answers.every(a => a !== null)) showResults(); }); document.getElementById('read-question').addEventListener('click', readQuestion); document.getElementById('voice-answer').addEventListener('click', voiceAnswer); document.getElementById('copy-summary').addEventListener('click', copySummary); document.getElementById('share-result').addEventListener('click', shareResult); document.getElementById('print-result').addEventListener('click', () => { showCertificate(); setTimeout(window.print, 100); }); document.getElementById('view-history').addEventListener('click', showHistoryPage); document.getElementById('restart-test').addEventListener('click', restartTest); document.getElementById('clear-history').addEventListener('click', clearHistory); document.getElementById('back-to-results').addEventListener('click', () => { document.getElementById('history').style.display = 'none'; document.getElementById('results').style.display = 'block'; document.getElementById('comparison-chart').style.display = 'none'; }); document.getElementById('print-cert').addEventListener('click', window.print); document.getElementById('back-to-results-cert').addEventListener('click', () => { document.getElementById('certificate').style.display = 'none'; document.getElementById('results').style.display = 'block'; }); if (window.matchMedia('(max-width: 1100px)').matches) { document.querySelector('.header').appendChild(document.getElementById('theme-select')); document.querySelector('.header').appendChild(document.querySelector('label[for="privacy-toggle"]').parentNode); } }
function loadTheme() {
try {
const savedTheme = localStorage.getItem('theme');
if (savedTheme) {
document.body.setAttribute('data-theme', savedTheme);
document.getElementById('theme-select').value = savedTheme;
} else {
document.getElementById('theme-select').value = 'auto';
}
} catch (e) { console.error(e); }
}

function loadPrivacy() {
try {
privacyMode = localStorage.getItem('privacy') === 'true';
} catch (e) { console.error(e); }
document.getElementById('privacy-toggle').checked = privacyMode;
if (privacyMode) {
hideAds();
document.getElementById('view-history').style.display = 'none';
}
}

function loadHistory() {
try {
history = JSON.parse(localStorage.getItem('adhd-history')) || [];
} catch (e) {
history = [];
}
}

function saveResult() {
if (privacyMode) return;
const result = {
timestamp: new Date().toISOString(),
score: currentResult.score,
percent: currentResult.percent,
likelihood: currentResult.likelihood,
answers: answers.slice()
};
history.push(result);
try {
localStorage.setItem('adhd-history', JSON.stringify(history));
} catch (e) { console.error(e); }
}

function showQuestion(index) {
document.getElementById('question-text').textContent = questions[index];
document.getElementById('progress-text').textContent = Question ${index + 1} of 18;
document.getElementById('progress-bar').style.width = ${(index + 1) / 18 * 100}%;
const answersDiv = document.getElementById('answers');
answersDiv.innerHTML = '';
answersOptions.forEach((opt, i) => {
const label = document.createElement('label');
const input = document.createElement('input');
input.type = 'radio';
input.name = 'answer';
input.value = answerValues[i];
if (answers[index] === answerValues[i]) input.checked = true;
input.style.display = 'none';
label.appendChild(input);
label.appendChild(document.createTextNode(opt));
label.classList.add('answer-btn');
if (input.checked) label.classList.add('selected');
input.addEventListener('change', () => {
answers[index] = parseInt(input.value);
[...answersDiv.querySelectorAll('label')].forEach(l => l.classList.remove('selected'));
label.classList.add('selected');
if (index < 17) showQuestion(++currentQuestion);
else showResults();
});
answersDiv.appendChild(label);
});
document.getElementById('prev-btn').disabled = index === 0;
}

function calculateScore() {
const score = answers.reduce((a, b) => a + b, 0);
const percent = Math.round(score / 72 * 100);
const posCountA = answers.slice(0, 6).filter(v => v >= (questions.slice(0,6).indexOf(questions[answers.indexOf(v)]) < 3 ? 2 : 3)).length; wait, no.
wait, for ASRS, the threshold for Part A is for Q1-3 >=2, Q4-6 >=3? No, the prompt says value >=3 for all Part A.
The prompt says "value ≥ 3" for Part A items.
But actually, in ASRS, it's specific: for Part A, the scoring is 'sometimes' or higher for some, 'often' for others.
But the prompt says value ≥ 3, but for simplicity, but to be accurate, let's check.
The prompt says "posCountA = number of Part A items with value ≥ 3"
But in real ASRS, Part A scoring is based on shaded boxes, which are 'sometimes' for Q1-3, 'often' for Q4-6.
So value >=2 for Q1-3, >=3 for Q4-6.
The prompt says value ≥ 3, but to pass acceptance 2: first four Part A to "Often" =3, rest "Never" =0, still High if >=4.
First four: Q1-4, for real, Q1-3 >=2, Q4 >=3, so if Often=3 for first four, 3>2 for 1-3, 3=3 for 4, so 4 positives, high.
But if prompt says >=3, for first three, if Often=3 >=3, yes.
But if user sets to Sometimes=2 for first three, Often for Q4, then for real it's high, but per prompt, 2<3, only 1 positive, low.
But acceptance 2 is first four to Often, which is 3>=3, 4 positives.
But to be accurate, perhaps adjust to real ASRS.
Let's see, the prompt says FULL ASRS v1.1, so perhaps I need to use the correct scoring.
The prompt has "posCountA = number of Part A items with value ≥ 3"
But in real ASRS, it's not that.
Let me confirm.
Since tools, but since date is 2025, but I can use web_search for "ASRS v1.1 scoring".

Yes, I think I need to fix to correct scoring.
Let's use tool.<|control12|>

<html lang="en"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>ADHD Self-Check - IBI TOOLS</title> <meta name="description" content="A private, fast, offline ADHD self-screening tool based on ASRS v1.1. Get instant results with charts and history tracking."> <script type="application/ld+json"> { "@context": "https://schema.org", "@type": "MedicalWebPage", "name": "ADHD Self-Check", "url": "https://example.com/adhd-checker.html", "about": { "@type": "MedicalCondition", "name": "Attention Deficit Hyperactivity Disorder (ADHD)" }, "description": "An online self-assessment tool for ADHD symptoms using the ASRS v1.1 questionnaire." } </script> <style> :root { --bg: #071025; --card: #0b1220; --muted: #94a3b8; --accent: #7c3aed; --glass: rgba(255,255,255,0.03); --text: #e6eef8; } [data-theme="light"] { --bg: #f8fafc; --card: #ffffff; --muted: #475569; --accent: #0ea5a4; --glass: rgba(2,6,23,0.03); --text: #0f172a; } [data-theme="amoled"] { --bg: #000000; --card: #111111; --muted: #888888; --accent: #7c3aed; --glass: rgba(255,255,255,0.01); --text: #ffffff; } [data-theme="high-contrast"] { --bg: #000000; --card: #ffffff; --muted: #000000; --accent: #ff0000; --glass: rgba(255,255,255,0); --text: #ffffff; border: 1px solid #ffffff; } body { background: var(--bg); color: var(--text); font-family: system-ui, sans-serif; margin: 0; padding: 0; display: grid; grid-template-columns: 1fr minmax(300px, 800px) 300px 1fr; min-height: 100vh; } main { grid-column: 2 / 3; padding: 1rem; } aside.sidebar { grid-column: 3 / 4; padding: 1rem; } .header { display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--card); border-radius: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); } .logo { width: 50px; height: 50px; background: linear-gradient(to bottom right, var(--accent), #ffffff); border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--bg); } .subtitle { text-align: center; margin: 1rem 0; } .card { background: var(--card); border-radius: 1rem; padding: 1rem; margin: 1rem 0; box-shadow: 0 4px 6px rgba(0,0,0,0.1); backdrop-filter: blur(10px); background: var(--glass); } .progress { background: var(--muted); height: 10px; border-radius: 5px; margin: 1rem 0; } .progress-bar { background: var(--accent); height: 100%; border-radius: 5px; transition: width 0.3s; } .answers { display: flex; flex-wrap: wrap; gap: 0.5rem; } .answer-btn { background: var(--glass); border: 1px solid var(--muted); border-radius: 0.5rem; padding: 0.5rem 1rem; cursor: pointer; transition: background 0.3s; display: block; } .answer-btn.selected { background: var(--accent); color: var(--bg); } .nav-btn { background: var(--accent); color: var(--bg); border: none; border-radius: 0.5rem; padding: 0.5rem 1rem; cursor: pointer; margin: 0.5rem; } #results, #history, #certificate { display: none; } canvas { max-width: 100%; } #ad-top, #ad-bottom { margin: 1rem 0; min-height: 90px; } .faq { margin: 2rem 0; } .faq details { margin: 1rem 0; } @media print { #ad-top, #ad-bottom, .nav-btn:not(#print-btn, #print-cert), #theme-select, #privacy-toggle, #sidebar, #view-history { display: none; } body { background: white; color: black; grid-template-columns: 1fr minmax(300px, 800px) 1fr; } aside { display: none; } } @media (prefers-color-scheme: light) { :root:not([data-theme]) { --bg: #f8fafc; --card: #ffffff; --muted: #475569; --accent: #0ea5a4; --glass: rgba(2,6,23,0.03); --text: #0f172a; } } @media (max-width: 1100px) { body { grid-template-columns: 1fr minmax(300px, 800px) 1fr; } aside.sidebar { display: none; } .header select, .header label { display: inline-block; } } </style> </head> <body data-theme="dark"> <main> <div id="ad-top"></div> <header class="header card"> <div class="logo">IBI</div> <div>Made by IBI</div> </header> <h2 class="subtitle">ADHD Self-Check — Private, Fast, Offline</h2> <div class="card" id="description"> <p>This tool is based on the Adult ADHD Self-Report Scale (ASRS v1.1). It is not a diagnostic tool. Consult a healthcare professional for proper diagnosis.</p> </div> <div class="card" id="test-container"> <div class="progress"><div class="progress-bar" id="progress-bar" style="width:0%;"></div></div> <p id="progress-text" aria-live="polite">Question 1 of 18</p> <h3 id="question-text"></h3> <button id="read-question">Read Question</button> <button id="voice-answer">Voice Answer</button> <div class="answers" id="answers" role="radiogroup" aria-label="Answer choices"></div> <button class="nav-btn" id="prev-btn">Back</button> <button class="nav-btn" id="next-btn">Next</button> </div> <div class="card" id="results"> <h2>Your Results</h2> <p id="score-text"></p> <p id="likelihood-text"></p> <p id="explanation"></p> <p><strong>Disclaimer:</strong> This is not medical advice. See a doctor for diagnosis.</p> <canvas id="bar-chart" width="400" height="200"></canvas> <canvas id="radar-chart" width="400" height="400"></canvas> <button id="copy-summary">Copy Summary</button> <button id="share-result">Share Result</button> <button id="print-result">Print Result</button> <button id="view-history">View History</button> <button id="restart-test">Restart Test</button> </div> <div class="card" id="history"> <h2>History</h2> <ul id="history-list"></ul> <canvas id="comparison-chart" width="400" height="200" style="display:none;"></canvas> <button id="clear-history">Clear All</button> <button id="back-to-results">Back to Results</button> </div> <div class="card" id="certificate"> <h2>ADHD Self-Check Certificate</h2> <p id="cert-date"></p> <p id="cert-score"></p> <p id="cert-likelihood"></p> <button id="print-cert">Print</button> <button id="back-to-results-cert">Back</button> </div> <section class="faq card"> <h2>FAQ</h2> <details> <summary>What is ADHD?</summary> <p>ADHD is a neurodevelopmental disorder characterized by inattention, hyperactivity, and impulsivity.</p> </details> <details> <summary>Is this test accurate?</summary> <p>This is a screening tool, not a diagnosis. Accuracy depends on honest answers.</p> </details> <details> <summary>How is the score calculated?</summary> <p>Based on ASRS v1.1: sum of responses, with Part A positives for likelihood.</p> </details> <details> <summary>Should I see a doctor?</summary> <p>Yes, if results indicate high likelihood or if symptoms affect your life.</p> </details> <details> <summary>Is my data private?</summary> <p>Yes, everything is offline and local. Privacy mode disables storage.</p> </details> </section> <div id="ad-bottom"></div> <footer class="card">Made by IBI — IBI TOOLS</footer> </main> <aside class="sidebar card" id="sidebar"> <h3>Settings</h3> <select id="theme-select"> <option value="auto">Auto</option> <option value="dark">Dark</option> <option value="light">Light</option> <option value="amoled">AMOLED</option> <option value="high-contrast">High Contrast</option> </select> <label>Privacy Mode: <input type="checkbox" id="privacy-toggle"></label> </aside> <script> const ADSENSE = { enabled: false, client: "ca-pub-XXXX", topSlot: "YYYY", bottomSlot: "ZZZZ" };
const questions = [
"How often do you have trouble wrapping up the final details of a project, once the challenging parts have been done?",
"How often do you have difficulty getting things in order when you have to do a task that requires organization?",
"How often do you have problems remembering appointments or obligations?",
"When you have a task that requires a lot of thought, how often do you avoid or delay getting started?",
"How often do you fidget or squirm with your hands or feet when you have to sit down for a long time?",
"How often do you feel overly active and compelled to do things, like you were driven by a motor?",
"How often do you make careless mistakes when you have to work on a boring or difficult project?",
"How often do you have difficulty keeping your attention when you are doing boring or repetitive work?",
"How often do you have difficulty concentrating on what people say to you, even when they are speaking to you directly?",
"How often do you misplace or have difficulty finding things at home or at work?",
"How often are you distracted by activity or noise around you?",
"How often do you leave your seat in meetings or other situations in which you are expected to remain seated?",
"How often do you feel restless or fidgety?",
"How often do you have difficulty unwinding and relaxing when you have time to yourself?",
"How often do you find yourself talking too much when you are in social situations?",
"When you’re in a conversation, how often do you find yourself finishing the sentences of the people you are talking to, before they can finish them themselves?",
"How often do you have difficulty waiting your turn in situations when turn taking is required?",
"How often do you interrupt others when they are busy?"
];
const answersOptions = ["Never", "Rarely", "Sometimes", "Often", "Very often"];
const answerValues = [0, 1, 2, 3, 4];

let answers = new Array(18).fill(null);
let currentQuestion = 0;
let privacyMode = false;
let history = [];
let currentResult = null;
let devMode = new URLSearchParams(window.location.search).get('dev') === '1';
let utterance = null;

function init() {
loadTheme();
loadPrivacy();
loadHistory();
showQuestion(0);
initAds();
if (devMode) {
document.body.insertAdjacentHTML('beforeend', '

<button onclick="clearStorage()">Clear Storage</button><button onclick="toggleAds()">Toggle Ads</button>
'); updateDevJson(); } document.getElementById('theme-select').addEventListener('change', e => { const theme = e.target.value; if (theme === 'auto') { document.body.removeAttribute('data-theme'); localStorage.removeItem('theme'); } else { document.body.setAttribute('data-theme', theme); localStorage.setItem('theme', theme); } }); document.getElementById('privacy-toggle').addEventListener('change', e => { privacyMode = e.target.checked; try { localStorage.setItem('privacy', privacyMode); } catch (e) { console.error(e); } if (privacyMode) { hideAds(); document.getElementById('view-history').style.display = 'none'; } else { showAds(); document.getElementById('view-history').style.display = ''; } }); document.getElementById('prev-btn').addEventListener('click', () => { if (currentQuestion > 0) showQuestion(--currentQuestion); }); document.getElementById('next-btn').addEventListener('click', () => { if (answers[currentQuestion] !== null && currentQuestion < 17) showQuestion(++currentQuestion); else if (currentQuestion === 17 && answers.every(a => a !== null)) showResults(); }); document.getElementById('read-question').addEventListener('click', readQuestion); document.getElementById('voice-answer').addEventListener('click', voiceAnswer); document.getElementById('copy-summary').addEventListener('click', copySummary); document.getElementById('share-result').addEventListener('click', shareResult); document.getElementById('print-result').addEventListener('click', () => { showCertificate(); setTimeout(window.print, 100); }); document.getElementById('view-history').addEventListener('click', showHistoryPage); document.getElementById('restart-test').addEventListener('click', restartTest); document.getElementById('clear-history').addEventListener('click', clearHistory); document.getElementById('back-to-results').addEventListener('click', () => { document.getElementById('history').style.display = 'none'; document.getElementById('results').style.display = 'block'; document.getElementById('comparison-chart').style.display = 'none'; }); document.getElementById('print-cert').addEventListener('click', window.print); document.getElementById('back-to-results-cert').addEventListener('click', () => { document.getElementById('certificate').style.display = 'none'; document.getElementById('results').style.display = 'block'; }); if (window.matchMedia('(max-width: 1100px)').matches) { document.querySelector('.header').appendChild(document.getElementById('theme-select')); document.querySelector('.header').appendChild(document.querySelector('label')); } }
function loadTheme() {
try {
const savedTheme = localStorage.getItem('theme');
if (savedTheme) {
document.body.setAttribute('data-theme', savedTheme);
document.getElementById('theme-select').value = savedTheme;
} else {
document.getElementById('theme-select').value = 'auto';
}
} catch (e) { console.error(e); }
}

function loadPrivacy() {
try {
privacyMode = localStorage.getItem('privacy') === 'true';
} catch (e) { console.error(e); }
document.getElementById('privacy-toggle').checked = privacyMode;
if (privacyMode) {
hideAds();
document.getElementById('view-history').style.display = 'none';
}
}

function loadHistory() {
try {
history = JSON.parse(localStorage.getItem('adhd-history')) || [];
} catch (e) {
history = [];
}
}

function saveResult() {
if (privacyMode) return;
const result = {
timestamp: new Date().toISOString(),
score: currentResult.score,
percent: currentResult.percent,
likelihood: currentResult.likelihood,
answers: answers.slice()
};
history.push(result);
try {
localStorage.setItem('adhd-history', JSON.stringify(history));
} catch (e) { console.error(e); }
}

function showQuestion(index) {
document.getElementById('question-text').textContent = questions[index];
document.getElementById('progress-text').textContent = Question ${index + 1} of 18;
document.getElementById('progress-bar').style.width = ${(index + 1) / 18 * 100}%;
const answersDiv = document.getElementById('answers');
answersDiv.innerHTML = '';
answersOptions.forEach((opt, i) => {
const label = document.createElement('label');
const input = document.createElement('input');
input.type = 'radio';
input.name = 'answer';
input.value = answerValues[i];
if (answers[index] === answerValues[i]) input.checked = true;
input.style.display = 'none';
label.appendChild(input);
label.appendChild(document.createTextNode(opt));
label.classList.add('answer-btn');
if (input.checked) label.classList.add('selected');
input.addEventListener('change', () => {
answers[index] = parseInt(input.value);
[...answersDiv.querySelectorAll('label')].forEach(l => l.classList.remove('selected'));
label.classList.add('selected');
if (index < 17) showQuestion(++currentQuestion);
else showResults();
});
answersDiv.appendChild(label);
});
document.getElementById('prev-btn').disabled = index === 0;
}

function calculateScore() {
const score = answers.reduce((a, b) => a + b, 0);
const percent = Math.round(score / 72 * 100);
let posCountA = 0;
for (let i = 0; i < 6; i++) {
const threshold = i < 3 ? 2 : 3;
if (answers[i] >= threshold) posCountA++;
}
const likelihood = posCountA >= 4 ? 'High likelihood' : 'Low/Moderate likelihood';
const explanation = likelihood === 'High likelihood' ? 'Your responses suggest a high possibility of ADHD symptoms. Consider professional evaluation.' : 'Your responses suggest lower ADHD symptoms, but if concerned, consult a doctor.';
return { score, percent, likelihood, explanation };
}

function showResults() {
currentResult = calculateScore();
document.getElementById('test-container').style.display = 'none';
document.getElementById('results').style.display = 'block';
document.getElementById('score-text').textContent = Score: ${currentResult.score}/72 (${currentResult.percent}%);
document.getElementById('likelihood-text').textContent = currentResult.likelihood;
document.getElementById('explanation').textContent = currentResult.explanation;
saveResult();
drawBarChart();
drawRadarChart();
if (devMode) updateDevJson();
}

function drawBarChart() {
try {
const ctx = document.getElementById('bar-chart').getContext('2d');
ctx.clearRect(0, 0, 400, 200);
ctx.fillStyle = var(--muted);
for (let i = 0; i < 18; i++) {
const height = answers[i] * 40;
ctx.fillRect(i * 20 + 10, 200 - height, 15, height);
ctx.fillText(i+1, i * 20 + 12, 190);
}
} catch (e) {
console.error('Bar chart error:', e);
alert('Error drawing bar chart.');
}
}

function drawRadarChart() {
try {
const ctx = document.getElementById('radar-chart').getContext('2d');
ctx.clearRect(0, 0, 400, 400);
const centerX = 200, centerY = 200, radius = 150;
ctx.beginPath();
ctx.moveTo(centerX, centerY - radius);
ctx.lineTo(centerX, centerY + radius);
ctx.strokeStyle = var(--muted);
ctx.stroke();

const inattention = answers.slice(0,9).reduce((a,b)=>a+b,0) / 36; // max 4*9=36, normalize to 1
const hyper = answers.slice(9).reduce((a,b)=>a+b,0) / 36;

ctx.beginPath();
ctx.moveTo(centerX, centerY - radius * inattention);
ctx.lineTo(centerX, centerY + radius * hyper);
ctx.closePath();
ctx.fillStyle = 'rgba(124, 58, 237, 0.3)';
ctx.fill();
ctx.strokeStyle = var(--accent);
ctx.stroke();

ctx.fillStyle = var(--text);
ctx.fillText('Inattention', centerX - 30, centerY - radius - 10);
ctx.fillText('Hyperactivity/Impulsivity', centerX - 80, centerY + radius + 20);
} catch (e) {
console.error('Radar chart error:', e);
alert('Error drawing radar chart.');
}
}

function readQuestion() {
try {
if (utterance) speechSynthesis.cancel();
utterance = new SpeechSynthesisUtterance(document.getElementById('question-text').textContent);
speechSynthesis.speak(utterance);
document.getElementById('read-question').textContent = 'Stop Reading';
document.getElementById('read-question').onclick = () => { speechSynthesis.cancel(); document.getElementById('read-question').textContent = 'Read Question'; };
utterance.onend = () => document.getElementById('read-question').textContent = 'Read Question';
} catch (e) {
alert('TTS not supported or error.');
}
}

function voiceAnswer() {
try {
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
if (!SpeechRecognition) throw new Error('Voice input not supported.');
const recognition = new SpeechRecognition();
recognition.onresult = e => {
const said = e.results[0][0].transcript.toLowerCase();
const index = answersOptions.findIndex(opt => opt.toLowerCase() === said);
if (index !== -1) {
answers[currentQuestion] = answerValues[index];
showQuestion(currentQuestion);
} else {
alert('Unrecognized: ' + said);
}
};
recognition.start();
} catch (e) {
alert('Voice input not supported.');
}
}

function copySummary() {
const text = ADHD Self-Check Result: Score ${currentResult.score}/72 (${currentResult.percent}%), ${currentResult.likelihood};
navigator.clipboard.writeText(text).then(() => alert('Copied!'));
}

function shareResult() {
if (navigator.share) {
navigator.share({
title: 'ADHD Self-Check Result',
text: Score: ${currentResult.score}/72 (${currentResult.percent}%), ${currentResult.likelihood}
});
} else {
alert('Share not supported.');
}
}

function showHistoryPage() {
document.getElementById('results').style.display = 'none';
document.getElementById('history').style.display = 'block';
const list = document.getElementById('history-list');
list.innerHTML = '';
history.forEach((item, i) => {
const li = document.createElement('li');
li.textContent = ${new Date(item.timestamp).toLocaleString()}: ${item.score}/72 - ${item.likelihood};
const viewBtn = document.createElement('button');
viewBtn.textContent = 'Compare';
viewBtn.onclick = () => compareHistory(i);
const delBtn = document.createElement('button');
delBtn.textContent = 'Delete';
delBtn.onclick = () => deleteHistory(i);
li.append(viewBtn, delBtn);
list.appendChild(li);
});
}

function compareHistory(index) {
const old = history[index];
const diff = currentResult.score - old.score;
alert(Old: ${old.score} (${old.likelihood}), New: ${currentResult.score} (${currentResult.likelihood}), Diff: ${diff});
drawComparisonChart(old.answers, answers);
}

function drawComparisonChart(oldAnswers, newAnswers) {
try {
const ctx = document.getElementById('comparison-chart').getContext('2d');
ctx.clearRect(0, 0, 400, 200);
document.getElementById('comparison-chart').style.display = 'block';
for (let i = 0; i < 18; i++) {
const oldHeight = oldAnswers[i] * 40;
const newHeight = newAnswers[i] * 40;
ctx.fillStyle = var(--muted);
ctx.fillRect(i * 20, 200 - oldHeight, 8, oldHeight);
ctx.fillStyle = var(--accent);
ctx.fillRect(i * 20 + 8, 200 - newHeight, 8, newHeight);
ctx.fillStyle = var(--text);
ctx.fillText(i+1, i * 20 + 4, 190);
}
} catch (e) {
console.error(e);
alert('Error drawing comparison chart.');
}
}

function deleteHistory(index) {
history.splice(index, 1);
try { localStorage.setItem('adhd-history', JSON.stringify(history)); } catch (e) { console.error(e); }
showHistoryPage();
}

function clearHistory() {
history = [];
try { localStorage.removeItem('adhd-history'); } catch (e) { console.error(e); }
showHistoryPage();
}

function restartTest() {
answers.fill(null);
currentQuestion = 0;
document.getElementById('results').style.display = 'none';
document.getElementById('test-container').style.display = 'block';
showQuestion(0);
}

function showCertificate() {
document.getElementById('cert-date').textContent = Date: ${new Date().toLocaleString()};
document.getElementById('cert-score').textContent = Score: ${currentResult.score}/72 (${currentResult.percent}%);
document.getElementById('cert-likelihood').textContent = currentResult.likelihood;
document.getElementById('results').style.display = 'none';
document.getElementById('certificate').style.display = 'block';
}

function initAds() {
if (!ADSENSE.enabled || privacyMode) return;
const script = document.createElement('script');
script.async = true;
script.src = https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=${ADSENSE.client};
script.crossOrigin = 'anonymous';
document.head.appendChild(script);

['top', 'bottom'].forEach(pos => {
const div = document.getElementById(ad-${pos});
const observer = new ResizeObserver(entries => {
if (entries[0].contentRect.width > 0) {
const ins = document.createElement('ins');
ins.className = 'adsbygoogle';
ins.style.display = 'block';
ins.dataset.adClient = ADSENSE.client;
ins.dataset.adSlot = ADSENSE[${pos}Slot];
ins.dataset.adFormat = 'auto';
ins.dataset.fullWidthResponsive = 'true';
div.appendChild(ins);
(window.adsbygoogle || []).push({});
observer.disconnect();
}
});
observer.observe(div);
});
}

function hideAds() {
document.getElementById('ad-top').style.display = 'none';
document.getElementById('ad-bottom').style.display = 'none';
}

function showAds() {
if (ADSENSE.enabled) {
document.getElementById('ad-top').style.display = '';
document.getElementById('ad-bottom').style.display = '';
}
}

function updateDevJson() {
if (!devMode) return;
try {
document.getElementById('dev-json').textContent = JSON.stringify({answers, currentResult, history, localStorage: Object.fromEntries(Object.entries(localStorage))}, null, 2);
} catch (e) { console.error(e); }
}

function clearStorage() {
try {
localStorage.clear();
} catch (e) { console.error(e); }
location.reload();
}

function toggleAds() {
ADSENSE.enabled = !ADSENSE.enabled;
if (ADSENSE.enabled) initAds();
else hideAds();
}

init();
</script>

</body> </html>
